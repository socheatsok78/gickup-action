name: test

on:
  workflow_dispatch:

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4

    - name: Adjust run image for testing
      run: |
        mkdir -p integration
        sed '$d' action.yml > integration/action.yml
        echo "  image: 'docker://ghcr.io/socheatsok78/gickup-action:${{ github.ref_name }}'" >> integration/action.yml

    - name: Run gickup integration tests
      uses: ./integration
      with:
        dryrun: 'true'
        debug: 'true'
        env: ${{ toJson(env) }}
        vars: ${{ toJson(vars) }}
        secrets: ${{ toJson(secrets) }}
